{% extends "base.njk" %}
{% set isHome = true %}

{% block title %}{{ config.siteName }} - 首页{% endblock %}

{% block content %}
    <!-- 英雄区 -->
    <section class="hero bg-gradient-to-br from-primary via-primary/90 to-secondary text-white rounded-2xl shadow-2xl mb-12 overflow-hidden relative h-screen flex items-center justify-center">
      <!-- 背景流动光效 -->
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_20%,rgba(255,255,255,0.15)_0%,transparent_50%),radial-gradient(circle_at_70%_60%,rgba(255,255,255,0.1)_0%,transparent_40%)]"></div>
      
      <!-- 旋转光晕 -->
      <div class="absolute top-0 right-0 w-[600px] h-[600px] bg-white/10 rounded-full filter blur-[100px] transform translate-x-1/3 -translate-y-1/3 animate-spin-slow"></div>
      <div class="absolute bottom-0 left-0 w-[500px] h-[500px] bg-white/10 rounded-full filter blur-[100px] transform -translate-x-1/3 translate-y-1/3 animate-spin-reverse-slow"></div>
      
      <!-- 网格装饰 -->
      <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiMyNTUuMCI+PHBhdGggZD0iTTEgMUg1OU0xIDExSDU5TTEgMjFIMjlNMzEgMjFIMjlNMSAzMUg1OU0zMSAzMUg1OU0xIDQxSDU5TTMxIDQxSDU5TTEgNTFIMjlNMzEgNTFIMjlNIiBmaWxsPSIjZmZmZmZmIiBmaWxsLW9wYWNpdHk9IjAuMDUiLz48L2c+PC9nPjwvc3ZnPg==')] opacity-30"></div>
      
      <!-- 粒子容器 -->
      <div id="particles-container" class="absolute inset-0"></div>
      
      <!-- 主要内容 -->
      <div class="relative z-10 text-center px-4">
       <h2 class="text-[clamp(2.5rem,8vw,5rem)] font-extrabold leading-tight mb-6 whitespace-nowrap overflow-hidden text-ellipsis max-w-full inline-block" id="hero-title">
  {{ config.siteName }}
</h2>
        <p class="mt-4 text-xl md:text-2xl text-white/90 max-w-3xl mx-auto mb-10 opacity-0" id="hero-desc">
          {{ config.siteDescription }}
        </p>
        <a href="{{ config.baseUrl }}/page/1/" class="mt-8 inline-flex items-center px-8 py-4 bg-white text-primary font-bold rounded-full shadow-lg hover:shadow-xl transform hover:-translate-y-1 hover:scale-105 transition-all duration-300 opacity-0" id="hero-cta">
          浏览全部文章
          <i class="fa fa-arrow-right ml-2"></i>
        </a>
      </div>
      
      <!-- 滚动指示器 -->
      <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 flex flex-col items-center opacity-0 animate-fade-in" style="animation-delay: 2.5s; animation-fill-mode: forwards;">
        <span class="text-sm mb-2">向下滚动</span>
        <i class="fa fa-chevron-down animate-bounce text-xl"></i>
      </div>
    </section>

    <!-- 自定义动画 -->
    <style>
      /* 基础动画 */
      @keyframes spin-slow {
        from { transform: translate(50%, -50%) rotate(0deg) scale(1); }
        to { transform: translate(50%, -50%) rotate(360deg) scale(1.2); }
      }

      @keyframes spin-reverse-slow {
        from { transform: translate(-50%, 50%) rotate(0deg) scale(1); }
        to { transform: translate(-50%, 50%) rotate(-360deg) scale(1.2); }
      }

      @keyframes fade-in {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(5deg); }
      }

      @keyframes pulse {
        0%, 100% { opacity: 0.6; }
        50% { opacity: 1; }
      }

      @keyframes slide-up {
        from { 
          opacity: 0;
          transform: translateY(50px) scale(0.95);
        }
        to { 
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      @keyframes letter-pop {
        0% {
          opacity: 0;
          transform: translateY(20px) scale(0.8);
        }
        70% {
          transform: translateY(-5px) scale(1.1);
        }
        100% {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      /* 应用动画类 */
      .animate-fade-in {
        animation: fade-in 0.8s ease forwards;
      }
      
      .animate-slide-up {
        animation: slide-up 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards;
      }
      
      .letter {
        display: inline-block;
        animation: letter-pop 0.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        opacity: 0;
      }
      
      .particle {
        position: absolute;
        background: white;
        border-radius: 50%;
        pointer-events: none;
        opacity: 0.6;
      }
    </style>

     <section class="featured-posts mb-16 opacity-0" id="featured-section">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold flex items-center">
          <i class="fa fa-star text-accent mr-2"></i>精选文章
        </h3>
        <a href="{{ config.baseUrl }}/page/1/" class="text-primary hover:underline flex items-center group">
          查看更多 <i class="fa fa-angle-right ml-1 group-hover:translate-x-1 transition-transform"></i>
        </a>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {% set featuredPosts = posts | filterByFeatured %}
        {# 使用配置中的 featured 数量 #}
        {% for post in featuredPosts.slice(0, config.postCounts.featured) %}
          <article class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-all duration-300 group transform hover:-translate-y-2">
            <!-- 文章内容 -->
            <div class="h-48 overflow-hidden">
              <img src="{{ (config.baseUrl + post.cover) or (config.defaultCoverImage) }}" alt="{{ post.title }}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700">
            </div>
            <div class="p-6">
              <div class="flex items-center text-sm text-gray-500 mb-3">
                <!-- 日历图标使用 primary 颜色，与 postlist 保持一致 -->
                <i class="fa fa-calendar-o mr-2 text-primary"></i>
                <span>{{ post.date | date('yyyy年MM月dd日') }}</span>
                {% if post.updated %}
                  <!-- 刷新图标使用 secondary 颜色，与 postlist 保持一致 -->
                  <span class="ml-4"><i class="fa fa-refresh mr-1 text-secondary"></i> 更新于 {{ post.relativeUpdated }}</span>
                {% endif %}
              </div>
              <h2 class="text-xl font-bold mb-3">
                <a href="{{ config.baseUrl }}/posts/{{ post.slug }}/" class="text-dark hover:text-primary transition-colors group-hover:underline">
                  {{ post.title }}
                </a>
              </h2>
              <p class="text-gray-600 mb-4 line-clamp-3">
                {{ post.excerpt | safe | striptags | truncate(120) }}
              </p>
              <div class="flex flex-wrap gap-2">
                {% for tag in post.tags.slice(0, 3) %}
                  <a href="{{ config.baseUrl }}/tags/{{ tag }}/" class="text-xs bg-primary/10 text-primary px-2 py-1 rounded-full hover:bg-primary/20 transition-colors">
                    #{{ tag }}
                  </a>
                {% endfor %}
              </div>
            </div>
          </article>
        {% endfor %}
      </div>
    </section>
    

  <!-- 最新文章区 -->
<section class="latest-posts opacity-0" id="latest-section">
  <div class="flex justify-between items-center mb-6">
    <h3 class="text-2xl font-bold flex items-center">
      <i class="fa fa-newspaper-o text-primary mr-2"></i>最新文章
    </h3>
    <a href="{{ config.baseUrl }}/page/1/" class="text-primary hover:underline flex items-center group">
      查看更多 <i class="fa fa-angle-right ml-1 group-hover:translate-x-1 transition-transform"></i>
    </a>
  </div>
  
  <!-- 传递 maxPosts 参数限制显示数量 -->
  {% set maxPosts = config.postCounts.latest %}
{% include "post_list.njk" %}
</section>

   <script>
  // 文字拆分动画 - 优化版
  document.addEventListener('DOMContentLoaded', () => {
    const heroTitle = document.getElementById('hero-title');
    const originalText = heroTitle.textContent;
    heroTitle.textContent = '';
    
    // 拆分文字为单个字符并添加动画（加快节奏）
    originalText.split('').forEach((char, index) => {
      const span = document.createElement('span');
      span.className = 'letter';
      span.style.animationDelay = `${0.07 * index}s`; // 缩短延迟间隔，加快文字弹出速度
      span.textContent = char === ' ' ? '\u00A0' : char;
      heroTitle.appendChild(span);
    });
    
    // 其他元素动画（缩短延迟）
    setTimeout(() => {
      document.getElementById('hero-desc').classList.add('animate-slide-up');
    }, 500); // 从800ms缩短到500ms
    
    setTimeout(() => {
      document.getElementById('hero-cta').classList.add('animate-slide-up');
    }, 900); // 从1300ms缩短到900ms
    
    // 滚动触发区域动画（增加交错效果）
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry, index) => {
        if (entry.isIntersecting) {
          // 增加区域入场延迟，形成层次感
          setTimeout(() => {
            entry.target.classList.add('animate-slide-up');
            observer.unobserve(entry.target);
          }, index * 300);
        }
      });
    }, { threshold: 0.1 });
    
    observer.observe(document.getElementById('featured-section'));
    observer.observe(document.getElementById('latest-section'));
    
    // 创建增强版粒子效果
    createEnhancedParticles();
  });
  
  // 增强版粒子效果生成函数（速度更明显）
  function createEnhancedParticles() {
    const container = document.getElementById('particles-container');
    const count = 70; // 增加粒子数量，增强视觉密度
    
    // 粒子大小范围分组（让粒子层次更丰富）
    const sizeRanges = [
      { min: 1, max: 3, count: Math.floor(count * 0.5) },  // 小粒子（50%）
      { min: 3, max: 6, count: Math.floor(count * 0.3) },  // 中粒子（30%）
      { min: 6, max: 10, count: count - Math.floor(count * 0.5) - Math.floor(count * 0.3) }  // 大粒子（20%）
    ];
    
    let particleIndex = 0;
    
    // 按大小分组生成粒子
    sizeRanges.forEach(range => {
      for (let i = 0; i < range.count; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        // 随机属性（加快速度，增强视觉效果）
        const size = Math.random() * (range.max - range.min) + range.min;
        const x = Math.random() * 100;
        const y = Math.random() * 100;
        const duration = Math.random() * 2 + 3; // 速度加快：4-10s（原10-25s）
        const delay = Math.random() * 3; // 缩短延迟：0-3s
        const opacity = Math.random() * 0.6 + 0.3; // 提高透明度：0.3-0.9
        const isFloating = Math.random() > 0.3; // 70%粒子有横向移动
        
        // 应用样式
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${x}%`;
        particle.style.top = `${y}%`;
        particle.style.opacity = opacity;
        particle.style.animation = isFloating 
          ? `float ${duration}s ease-in-out infinite ${delay}s, drift ${(duration * 2) + Math.random() * 5}s ease-in-out infinite ${delay + 1}s`
          : `float ${duration}s ease-in-out infinite ${delay}s`;
        
        // 随机添加发光效果
        if (Math.random() > 0.7) {
          particle.style.boxShadow = `0 0 ${size * 2}px rgba(255, 255, 255, 0.6)`;
        }
        
        container.appendChild(particle);
        particleIndex++;
      }
    });
  }
  
  // 为文章列表项添加动画（增强交错效果）
  document.addEventListener('DOMContentLoaded', () => {
    const postItems = document.querySelectorAll('.post-summary');
    postItems.forEach((item, index) => {
      item.classList.add('opacity-0');
      
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            // 动态调整延迟，让动画更有节奏感
            const delay = index % 2 === 0 ? index * 80 : index * 120;
            setTimeout(() => {
              entry.target.classList.add('animate-slide-up');
              // 添加缩放效果增强灵动性
              entry.target.style.transform = 'scale(0.95)';
              setTimeout(() => {
                entry.target.style.transform = 'scale(1)';
              }, 100);
              observer.unobserve(entry.target);
            }, delay);
          }
        });
      }, { threshold: 0.1 });
      
      observer.observe(item);
    });
  });
</script>

<!-- 增强动画样式 -->
<style>
  /* 加快文字弹出动画 */
  @keyframes letter-pop {
    0% {
      opacity: 0;
      transform: translateY(20px) scale(0.8);
    }
    70% {
      transform: translateY(-3px) scale(1.1); /* 增强弹跳感 */
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  /* 增强上浮动画 */
  @keyframes slide-up {
    from { 
      opacity: 0;
      transform: translateY(30px) scale(0.95);
    }
    to { 
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  /* 粒子浮动动画（增强幅度） */
  @keyframes float {
    0%, 100% { 
      transform: translateY(0) rotate(0deg);
    }
    50% { 
      transform: translateY(-20px) rotate(10deg); /* 加大浮动幅度和旋转角度 */
    }
  }
  
  /* 粒子横向漂移动画 */
  @keyframes drift {
    0%, 100% { 
      transform: translateX(0);
    }
    50% { 
      transform: translateX(15px); /* 增加横向移动，增强动感 */
    }
  }
  
  /* 应用动画类 */
  .animate-slide-up {
    animation: slide-up 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  }
  
  .letter {
    display: inline-block;
    animation: letter-pop 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    opacity: 0;
  }
  
  .particle {
    position: absolute;
    background: white;
    border-radius: 50%;
    pointer-events: none;
    transition: all 0.3s ease;
  }
</style>
{% endblock %}